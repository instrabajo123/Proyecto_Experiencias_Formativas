<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mis Publicaciones | GalerÃ­a Virtual</title>

  <!-- ESTILOS GLOBALES -->
  <link rel="stylesheet" href="/assets/css/styles.css">
  <link rel="stylesheet" href="/assets/css/ui.css">
</head>
<body>

<header class="header-hero">
  <div class="logo">GalerÃ­a Virtual</div>

  <nav class="nav-right">
      <a href="/views/index.html" class="nav-link">Inicio</a>
      <a href="/views/publicar.html" class="nav-link">Publicar</a>
      <a href="/views/portafolio.html" class="nav-link">Portafolio</a>

      <button id="loginBtn" class="btn btn-ghost">Acceder</button>

      <div id="userMenuWrapper" style="display:none; position:relative;">
          <div id="avatarUser" class="user-avatar">U</div>

          <div id="userDropdown" class="menu-dropdown hidden">
              <p class="menu-section-title">Cuenta</p>
              <button class="menu-item" onclick="location.href='/views/portafolio.html'">ğŸ“ Mi portafolio</button>
              <button class="menu-item" onclick="location.href='/views/mis_publicaciones.html'">ğŸ§¾ Mis publicaciones</button>
              <button class="menu-item" onclick="location.href='/views/pedidos.html'">ğŸ›’ Mis compras</button>
              <button class="menu-item" onclick="location.href='/views/perfil.html'">âš™ï¸ Perfil</button>

              <button id="panelAdminBtn" class="menu-item admin-item hidden" onclick="location.href='/views/admin.html'">ğŸ›  Panel Admin</button>

              <hr class="menu-line">
              <button id="logoutBtn" class="menu-item logout">ğŸšª Cerrar sesiÃ³n</button>
          </div>
      </div>
  </nav>
</header>

<main style="max-width:1200px;margin:30px auto;padding:0 20px;">
    <h2 class="titulo-seccion">Mis Publicaciones</h2>

    <!-- LOADING -->
    <div id="mispub-loading" class="loading-row">
      <div class="skeleton"></div>
      <div class="skeleton"></div>
      <div class="skeleton"></div>
    </div>

    <!-- CONTENEDOR DE TRABAJOS -->
    <div id="mispub-container" class="galeria"></div>
</main>

<footer class="footer">Â© 2025 GalerÃ­a Virtual</footer>


<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

<script src="/assets/js/firebase.js"></script>
<script src="/assets/js/script.js"></script>
<script src="/assets/js/script_user.js"></script>

<script>
/* ===========================================
   CARGAR MIS PUBLICACIONES
=========================================== */

const authMP = firebase.auth();
const dbMP = firebase.firestore();

document.addEventListener("DOMContentLoaded", () => {

    const cont = document.getElementById("mispub-container");
    const loader = document.getElementById("mispub-loading");

    authMP.onAuthStateChanged(async user => {
        if (!user) {
            cont.innerHTML = "<p style='padding:20px;color:red'>Debes iniciar sesiÃ³n.</p>";
            loader.style.display = "none";
            return;
        }

        const snap = await dbMP
            .collection("trabajos")
            .where("autorUid", "==", user.uid)
            .orderBy("creado", "desc")
            .get();

        loader.style.display = "none";
        cont.innerHTML = "";

        if (snap.empty) {
            cont.innerHTML = "<p style='padding:20px;color:#777'>AÃºn no has publicado trabajos.</p>";
            return;
        }

        snap.forEach(doc => {
            const t = doc.data();

            cont.innerHTML += `
                <div class="card">
                    <img src="${t.imageUrl}" alt="">
                    <div class="contenido">
                        <h3>${t.titulo}</h3>
                        <p>${t.descripcion}</p>

                        <p style="font-size:.85rem;color:${
                            t.aprobado ? 'green' : 'orange'
                        };">
                           Estado: <strong>${t.aprobado ? "Aprobado" : "Pendiente"}</strong>
                        </p>

                        <button class="btn-detalles" onclick="verTrabajo('${doc.id}')">
                            Ver detalles
                        </button>
                    </div>
                </div>
            `;
        });
    });

});
</script>

</body>
</html>
